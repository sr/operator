<h1>
  <%= content_tag :i, "", class: "icon-#{current_project.icon}" %>
  <%= current_project.titleized_name %>
</h1>

<h2 class="steps-count" style="border-bottom: none;">Step 1 of 3</h2>

<div>
  <%= render partial: "application/deploy_what_tabs" %>
  <% unless current_project.test_list.empty? %>
    <div class="row">
      <div class="col-md-2 col-md-offset-6" style="font-size: 1.5em;">
        Test Plans
      </div>
    </div>
  <% end %>
  <div class="row">
    <div class="well well-sm col-md-3" style="margin-left: 15px; margin-right: -15px;">
      <%= form_tag request.path, method: "get", class: "form form-inline", id: "include-untested-build-form" do |f| %>
        <%= check_box_tag :include_untested_builds, "1", @include_untested_builds %>
        <%= label_tag :include_untested_builds, "Include Fully Untested Builds?" %>
      <%- end %>
    </div>
    <% current_project.test_list.values.each_with_index do |test_name, i| %>
      <div class="col-md-1<%= " col-md-offset-1" if i == 0 %>"><label><%= test_name %></label></div>
    <% end %>
  </div>

  <%- if @builds.empty? %>
    <p>
      <strong>Sorry, there are no recent builds for this branch.</strong>
    </p>
  <%- else %>
    <ul class="list-unstyled deploy-list">
      <% @builds.each do |build| %>
        <li>
          <div class="row">
            <div class="col-md-3">
              <h4>
                <%= link_to "Ship This", select_target_project_deploys_path(current_project, artifact_url: build.artifact_url), class: "btn btn-primary btn-xs btn-success deploy-button" %>
                &nbsp;
                <%= deploy_type_icon("build") %> build<%= build.build_number %>
                <%- if !build.passed_ci? %>
                  <span class="label label-danger">Untested</span>
                <%- end %>
              </h4>
              <small class="muted">
                commit:
                <%= link_to current_project.sha_url(build.sha), title: build.sha do %>
                  <%= sha_span(build.sha)  %>
                <%- end %>
              </small>
            </div>
            <% current_project.test_list.keys.each_with_index do |test, i| %>
              <div class="col-md-1<%= " col-md-offset-1" if i == 0 %>">
                <%= render partial: "streetlight", locals: { state: build.test_state(test), build_url: build.build_url(test) } %>
              </div>
            <% end %>
          </div>
          <hr>
        </li>
      <% end %>
    </ul>
  <%- end %>
</div>
